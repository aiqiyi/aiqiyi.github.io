<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1, minimum-scale=1, maximum-scale=1">
        <meta name="keywords" content="php,excel,">
        <meta name="description" content="PHPExcel 用法详解">
        <link rel="stylesheet" href="/bundle/index.css">
        <title>PHPExcel 用法详解</title>
    </head>
    <body>
        <article class="container">
            <a class="index" href="/">PHP</a>
<ul class="menu">
    <li class="menu-item"><a href="/archive.html">归档</a></li>
    <li class="menu-item"><a href="/tag.html">标签</a></li>
    <li class="menu-item"><a href="/atom.xml">订阅</a></li>
</ul>
<script type="text/javascript">
    var timeSinceLang = {
        year: '年前',
        month: '个月前',
        day: '天前',
        hour: '小时前',
        minute: '分钟前',
        second: '秒前'
    };
</script>

<script type="text/javascript">
    var conn, reloadTimer, connectTimer;
    var connect = function() {
        conn = new WebSocket('ws://' + location.host + '/live');
        conn.onmessage = function(event) {
            if (event.data === 'change') {
                if (reloadTimer) clearTimeout(reloadTimer);
                reloadTimer = setTimeout(function() {
                    window.location.reload();
                }, 200);
            }
        };
        conn.onclose = function() {
            if (connectTimer) clearTimeout(connectTimer);
            connectTimer = setTimeout(function() {
                connect();
            }, 1000);
        };
    };
    connect();
</script>


            <article class="main article">
                <h1 class="title">PHPExcel 用法详解</h1>
                <section class="info">
                    <span class="avatar" style="background-image: url(/images/avatar.jpg);"></span>
                    <a class="name" href="/about.me.html">言唸</a>
                    <span class="date" data-time="1458785280">
                        <span class="from"></span>
                        <span class="date" data-time="1458785280">(<span class="from"></span> 更新)</span>
                    </span>
                    <span class="tags"><a class="tag" href="/tag/php/index.html">php</a><a class="tag" href="/tag/excel/index.html">excel</a></span>
                </section>
                <article class="content"><h4>（1）require</h4>

<pre><code>&lt;?php
require_once './phpexcel/PHPExcel.php';
</code></pre>

<pre><code class="language-yaml">//设定时区
date_default_timezone_set('PRC'); 
//创建一个新的对象  PHPExcel object
$objPHPExcel = new PHPExcel();
</code></pre>

<h4>（2）文件属性，全局属性</h4>

<pre><code class="language-yaml">// 设置文件的一些属性，在xls文件——&gt;属性——&gt;详细信息里可以看到这些值，xml表格里是没有这些值的
$objPHPExcel
      -&gt;getProperties()  //获得文件属性对象，给下文提供设置资源
      -&gt;setCreator( &quot;Maarten Balliauw&quot;)                 //设置文件的创建者
      -&gt;setLastModifiedBy( &quot;Maarten Balliauw&quot;)          //设置最后修改者
      -&gt;setTitle( &quot;Office 2007 XLSX Test Document&quot; )    //设置标题
      -&gt;setSubject( &quot;Office 2007 XLSX Test Document&quot; )  //设置主题
      //设置备注
      -&gt;setDescription( &quot;Test document for Office 2007 XLSX, generated using PHP classes.&quot;) 
      -&gt;setKeywords( &quot;office 2007 openxml php&quot;)        //设置标记
      -&gt;setCategory( &quot;Test result file&quot;);                //设置类别

$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setName( 'Arial'); //默认的字体
$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setName(iconv('gbk', 'utf-8', '宋体'));
$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setSize(20); //文字大小
</code></pre>

<h4>（3）表格设定</h4>

<pre><code class="language-yaml">// 给表格添加数据
//设置第一个内置表（一个xls文件里可以有多个表）为活动的
$objPHPExcel-&gt;setActiveSheetIndex(0)             
            -&gt;setCellValue( 'A1', 'Hello' )         //给表的单元格设置数据
            -&gt;setCellValue( 'B2', 'world!' )      //数据格式可以为字符串
            -&gt;setCellValue( 'C1', 12)            //数字型
            -&gt;setCellValue( 'D2', 12)            //
            -&gt;setCellValue( 'D3', true )           //布尔型
            -&gt;setCellValue( 'D4', '=SUM(C1:D2)' );//公式
//循环添加
for($i = 1;$i&lt;200;$i++) {
  $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A' . $i, $i);
  $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B' . $i, 'Test value');
}

//得到当前活动的表,注意下文教程中会经常用到$objActSheet
$objActSheet = $objPHPExcel-&gt;getActiveSheet();
//  $objPHPExcel-&gt;getActiveSheet()  ==  $objActSheet
//设置行高 -1自动调整行高（别的值则为行高）
$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension(8)-&gt;setRowHeight(-1); 
//设置一列的宽度
$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('A')-&gt;setWidth(15); 
//内容自适应
                  $objActSheet-&gt;getColumnDimension('B')-&gt;setAutoSize(true);   

$dateTimeNow = time();//获得秒值变量
//三个表格分别设置为当前实际的 日期格式、时间格式、日期和时间格式
/*首先将单元格的值设置为由PHPExcel_Shared_Date::PHPToExcel方法转换后的excel格式的值
然后用过得到该单元格的样式里面数字样式再设置显示格式*/
$objActSheet-&gt;setCellValue( 'C9', PHPExcel_Shared_Date::PHPToExcel( $dateTimeNow )); 
$objActSheet-&gt;getStyle( 'C9')-&gt;getNumberFormat()
                    -&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_DATE_YYYYMMDD2);
$objActSheet-&gt;setCellValue( 'C10', PHPExcel_Shared_Date::PHPToExcel( $dateTimeNow ));

$objActSheet-&gt;getStyle( 'C10')-&gt;getNumberFormat()
                    -&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_DATE_TIME4);
$objActSheet-&gt;setCellValue( 'C10', PHPExcel_Shared_Date::PHPToExcel( $dateTimeNow ));

$objActSheet-&gt;getStyle( 'C10')-&gt;getNumberFormat()
                    -&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_DATE_TIME4);
//将E4到E13的数字格式设置为EUR
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'E4:E13')-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_EUR_SIMPLE);


/*设置打印时候的页眉页脚（设置完了以后可以通过打印预览来看效果）
    字符串中的&amp;*好像是一些变量*/
$objActSheet-&gt;getHeaderFooter()
                -&gt;setOddHeader( '&amp;L&amp;G&amp;C&amp;HPlease treat this document as confidential!');
$objActSheet-&gt;getHeaderFooter()
                -&gt;setOddFooter( '&amp;L&amp;B' . $objPHPExcel-&gt;getProperties()-&gt;getTitle() . '&amp;RPage &amp;P of &amp;N' );

//设置页面文字的方向和页面大小
$objPHPExcel-&gt;getActiveSheet()-&gt;getPageSetup()
                -&gt;setOrientation(PHPExcel_Worksheet_PageSetup:: ORIENTATION_LANDSCAPE);
$objPHPExcel-&gt;getActiveSheet()-&gt;getPageSetup()
                -&gt;setPaperSize(PHPExcel_Worksheet_PageSetup:: PAPERSIZE_A4);     //A4纸大小
</code></pre>

<h4>（3）单元格设定</h4>

<pre><code class="language-yaml">//设置单元格的批注
//设置作者
$objPHPExcel-&gt;getActiveSheet()-&gt;getComment( 'E13')-&gt;setAuthor('PHPExcel' );  
//添加批注   
$objCommentRichText = $objPHPExcel-&gt;getActiveSheet()-&gt;getComment('E13' )-&gt;getText()-&gt;createTextRun('PHPExcel:');  
//将现有批注加粗
$objCommentRichText-&gt;getFont()-&gt;setBold( true);  
//添加更多批注
$objPHPExcel-&gt;getActiveSheet()-&gt;getComment( 'E13')-&gt;getText()-&gt;createTextRun(&quot;\r\n&quot; );      
$objPHPExcel-&gt;getActiveSheet()-&gt;getComment( 'E13')-&gt;getText()
                    -&gt;createTextRun('Total amount on the current invoice, including VAT.' );
//设置批注显示的宽高 ，在office中有效在wps中无效
$objPHPExcel-&gt;getActiveSheet()-&gt;getComment( 'E13')-&gt;setWidth('100pt' );      
$objPHPExcel-&gt;getActiveSheet()-&gt;getComment( 'E13')-&gt;setHeight('100pt' );
$objPHPExcel-&gt;getActiveSheet()-&gt;getComment( 'E13')-&gt;setMarginLeft('150pt' );
//设置背景色 ，在office中有效在wps中无效
$objPHPExcel-&gt;getActiveSheet()-&gt;getComment( 'E13')-&gt;getFillColor()-&gt;setRGB('EEEEEE' );      

//合并拆分单元格
$objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells( 'A28:B28');      // A28:B28合并
$objPHPExcel-&gt;getActiveSheet()-&gt;unmergeCells( 'A28:B28');    // A28:B28再拆分

//单元格密码保护
//将B1的文字字体设置为Candara，20号的粗体下划线有背景色
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'B1')-&gt;getFont()-&gt;setName('Candara' ); //字体设置为Candara
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'B1')-&gt;getFont()-&gt;setSize(20); //20号字体
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'B1')-&gt;getFont()-&gt;setBold(true); //粗体
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'B1')-&gt;getFont()-&gt;setUnderline(PHPExcel_Style_Font::UNDERLINE_SINGLE);//下划线
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'B1')-&gt;getFont()-&gt;getColor()-&gt;setARGB(PHPExcel_Style_Color::COLOR_WHITE); //背景色
</code></pre>

<h4>（4）对其方式</h4>

<pre><code class="language-yaml">//文字对齐方式
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'D11')-&gt;getAlignment()-&gt;setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);    //水平方向上对齐
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('A18')-&gt;getAlignment()-&gt;setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_JUSTIFY);//水平方向上两端对齐
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'A18')-&gt;getAlignment()-&gt;setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);       //垂直方向上中间居中
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('A3')-&gt;getAlignment()-&gt;setWrapText(true); 
</code></pre>

<h4>（5）边框设定</h4>

<pre><code class="language-yaml">//设置列边框
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('A4')-&gt;getBorders()-&gt;getTop()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THIN); //上边框
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('A10')-&gt;getBorders()-&gt;getLeft()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THIN); //左边框
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('E10')-&gt;getBorders()-&gt;getRight()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THIN);//右边框
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('D13')-&gt;getBorders()-&gt;getLeft()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THICK);//左边框
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('E13')-&gt;getBorders()-&gt;getBottom()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THICK);//下边框
//设置边框颜色
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('D13')-&gt;getBorders()-&gt;getLeft()-&gt;getColor()-&gt;setARGB('FF993300');
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('D13')-&gt;getBorders()-&gt;getTop()-&gt;getColor()-&gt;setARGB('FF993300');
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('D13')-&gt;getBorders()-&gt;getBottom()-&gt;getColor()-&gt;setARGB('FF993300');
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('E13')-&gt;getBorders()-&gt;getRight()-&gt;getColor()-&gt;setARGB('FF993300');
</code></pre>

<h4>（6）冻结窗格</h4>

<pre><code class="language-yaml">//冻结窗格
$objPHPExcel-&gt;getActiveSheet()-&gt;freezePane('A2'); //冻结窗格A2
</code></pre>

<h4>（7）Rows to repeat at top</h4>

<pre><code>//Rows to repeat at top 在顶部重复的行
$objPHPExcel-&gt;getActiveSheet()-&gt;getPageSetup()-&gt;setRowsToRepeatAtTopByStartAndEnd(1, 1);
</code></pre>

<h4>（8）综合设定边框</h4>

<pre><code class="language-yaml">//设置单元格边框
$styleThinBlackBorderOutline = array(
       'borders' =&gt; array (
             'outline' =&gt; array (
                   'style' =&gt; PHPExcel_Style_Border::BORDER_THIN,   //设置border样式
                   //'style' =&gt; PHPExcel_Style_Border::BORDER_THICK,  另一种样式
                   'color' =&gt; array ('argb' =&gt; 'FF000000'),          //设置border颜色
            ),
      ),
);
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'A4:E10')-&gt;applyFromArray($styleThinBlackBorderOutline);
</code></pre>

<h4>（9）设置填充的样式和背景色</h4>

<pre><code class="language-yaml">//设置填充的样式和背景色
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'A1:E1')-&gt;getFill()-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID); // 这句不可少
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'A1:E1')-&gt;getFill()-&gt;getStartColor()-&gt;setARGB('FF808080');

//综合设置样例
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('A1:T100')-&gt;applyFromArray(
  array('fill'  =&gt; array(
                'type'    =&gt; PHPExcel_Style_Fill::FILL_SOLID,
                'color'   =&gt; array('argb' =&gt; 'FFCCFFCC')
              ),
      'borders' =&gt; array(
                'bottom'  =&gt; array('style' =&gt; PHPExcel_Style_Border::BORDER_THIN),
                'right'   =&gt; array('style' =&gt; PHPExcel_Style_Border::BORDER_MEDIUM)
              )
     )
  );

//综合设置样例
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'A3:E3')-&gt;applyFromArray(
             array(
                   'font'    =&gt; array (
                         'bold'      =&gt; true
                   ),
                   'alignment' =&gt; array (
                         'horizontal' =&gt; PHPExcel_Style_Alignment::HORIZONTAL_RIGHT ,
                  ),
                   'borders' =&gt; array (
                         'top'     =&gt; array (
                               'style' =&gt; PHPExcel_Style_Border::BORDER_THIN
                        )
                  ),
                   'fill' =&gt; array (
                         'type'       =&gt; PHPExcel_Style_Fill::FILL_GRADIENT_LINEAR ,
                         'rotation'   =&gt; 90,
                         'startcolor' =&gt; array (
                               'argb' =&gt; 'FFA0A0A0'
                         ),
                         'endcolor'   =&gt; array (
                               'argb' =&gt; 'FFFFFFFF'
                         )
                  )
            )
);
</code></pre>

<h4>（10）单元格内容url超链接 &amp;&amp; 图片</h4>

<pre><code class="language-yaml">//给单元格内容设置url超链接
$objActSheet-&gt;getCell('E26')-&gt;getHyperlink()-&gt;setUrl( 'http://www.phpexcel.net');    //超链接url地址
$objActSheet-&gt;getCell('E26')-&gt;getHyperlink()-&gt;setTooltip( 'Navigate to website');  //鼠标移上去连接提示信息

$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('E26', 'www.phpexcel.net');  
$objPHPExcel-&gt;getActiveSheet()-&gt;getCell('E26')-&gt;getHyperlink()-&gt;setUrl('http://www.phpexcel.net');  
$objPHPExcel-&gt;getActiveSheet()-&gt;getCell('E26')-&gt;getHyperlink()-&gt;setTooltip('Navigate to website');  
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('E26')-&gt;getAlignment()-&gt;setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);  


//给表中添加图片
$objDrawing = new PHPExcel_Worksheet_Drawing();
$objDrawing-&gt;setName('Paid');
$objDrawing-&gt;setDescription('Paid');
$objDrawing-&gt;setPath('./images/paid.png'); //图片引入位置
$objDrawing-&gt;setCoordinates('B15'); //图片添加位置
$objDrawing-&gt;setOffsetX(210);
$objDrawing-&gt;setRotation(25); 
$objDrawing-&gt;setHeight(36);
$objDrawing-&gt;getShadow()-&gt;setVisible (true );
$objDrawing-&gt;getShadow()-&gt;setDirection(45);
$objDrawing-&gt;setWorksheet($objPHPExcel-&gt;getActiveSheet());
//还可以添加有gd库生产的图片，详细见自带实例25
</code></pre>

<h4>（11）删除和隐藏</h4>

<pre><code class="language-yaml">//添加或删除行和列
$objPHPExcel-&gt;getActiveSheet()-&gt;insertNewRowBefore(6, 10);   //在行6前添加10行
$objPHPExcel-&gt;getActiveSheet()-&gt;removeRow(6, 10);                  //从第6行往后删去10行
$objPHPExcel-&gt;getActiveSheet()-&gt;insertNewColumnBefore( 'E', 5);    //从第E列前添加5类
$objPHPExcel-&gt;getActiveSheet()-&gt;removeColumn( 'E', 5);             //从E列开始往后删去5列
$objPHPExcel-&gt;getActiveSheet()-&gt;removeRow(4,1);       //删去第4行

//隐藏和显示某列
$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension( 'C')-&gt;setVisible(false);          //隐藏
$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension( 'D')-&gt;setVisible(true);           //显示
</code></pre>

<h4>（12）重命名</h4>

<pre><code>//重新命名活动的表的标签名称
$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle( 'Simple');
$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle(iconv('gbk', 'utf-8', 'phpexcel测试'));
</code></pre>

<h4>（13）安全</h4>

<pre><code class="language-yaml">//保护cell
$objPHPExcel-&gt;getActiveSheet()-&gt;getProtection()-&gt;setSheet(true); // Needs to be set to true in order to enable any worksheet protection!
$objPHPExcel-&gt;getActiveSheet()-&gt;protectCells('A3:E13', 'PHPExcel');  //保护单元格，设定密码PHPExcel

//设置工作表的安全
$objPHPExcel-&gt;getActiveSheet()-&gt;getProtection()-&gt;setPassword( 'PHPExcel');
$objPHPExcel-&gt;getActiveSheet()-&gt;getProtection()-&gt;setSheet( true); // This should be enabled in order to enable any of the following!
$objPHPExcel-&gt;getActiveSheet()-&gt;getProtection()-&gt;setSort( true);
$objPHPExcel-&gt;getActiveSheet()-&gt;getProtection()-&gt;setInsertRows( true);
$objPHPExcel-&gt;getActiveSheet()-&gt;getProtection()-&gt;setFormatCells( true);

//设置文档安全
$objPHPExcel-&gt;getSecurity()-&gt;setLockWindows( true);
$objPHPExcel-&gt;getSecurity()-&gt;setLockStructure( true);
$objPHPExcel-&gt;getSecurity()-&gt;setWorkbookPassword( &quot;PHPExcel&quot;);     //设置密码


//设置整张表为只读，然后解锁A2-B2为为受保护的
$objPHPExcel-&gt;getActiveSheet()-&gt;getProtection()-&gt;setSheet(true);  
$objPHPExcel-&gt;getActiveSheet()
  -&gt;getStyle('A2:B2')
  -&gt;getProtection()-&gt;setLocked(
    PHPExcel_Style_Protection::PROTECTION_UNPROTECTED
  );
</code></pre>

<h4>（14）样式赋值详解</h4>

<pre><code class="language-yaml">//样式赋值详解
$objConditional1 = new PHPExcel_Style_Conditional();      //实例化
$objConditional1-&gt;setConditionType(PHPExcel_Style_Conditional::CONDITION_CELLIS)    //设定属性    单元格
                -&gt;setOperatorType(PHPExcel_Style_Conditional::OPERATOR_BETWEEN)     //设定属性    between
                -&gt;addCondition('200')                                               //200   -   400 之间
                -&gt;addCondition('400');
$objConditional1-&gt;getStyle()-&gt;getFont()-&gt;getColor()-&gt;setARGB(PHPExcel_Style_Color::COLOR_YELLOW);  //文字颜色    黄色
$objConditional1-&gt;getStyle()-&gt;getFont()-&gt;setBold(true);                                            //加粗
$objConditional1-&gt;getStyle()-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_EUR_SIMPLE);   //格式化数字

$objConditional2 = new PHPExcel_Style_Conditional();       //实例化
$objConditional2-&gt;setConditionType(PHPExcel_Style_Conditional::CONDITION_CELLIS)
                -&gt;setOperatorType(PHPExcel_Style_Conditional::OPERATOR_LESSTHAN)    //设定属性     lessthan   小于
                -&gt;addCondition('0');                                                //   小于 0 的
$objConditional2-&gt;getStyle()-&gt;getFont()-&gt;getColor()-&gt;setARGB(PHPExcel_Style_Color::COLOR_RED);       //文字颜色     红色
$objConditional2-&gt;getStyle()-&gt;getFont()-&gt;setItalic(true);                                            //斜体
$objConditional2-&gt;getStyle()-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_EUR_SIMPLE);

$objConditional3 = new PHPExcel_Style_Conditional();
$objConditional3-&gt;setConditionType(PHPExcel_Style_Conditional::CONDITION_CELLIS)
                -&gt;setOperatorType(PHPExcel_Style_Conditional::OPERATOR_GREATERTHANOREQUAL)   //设定属性     greaterThanOrEqual   大于或者等于
                -&gt;addCondition('0');                                                         //大于等于 0  的
$objConditional3-&gt;getStyle()-&gt;getFont()-&gt;getColor()-&gt;setARGB(PHPExcel_Style_Color::COLOR_GREEN);      //绿色
$objConditional3-&gt;getStyle()-&gt;getFont()-&gt;setItalic(true);
$objConditional3-&gt;getStyle()-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_EUR_SIMPLE);

$conditionalStyles = $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('B2')-&gt;getConditionalStyles();        //获取B2 的单元格样式  $conditionalStyles
array_push($conditionalStyles, $objConditional1);                                                   //在$conditionalStyles 后插入$objConditional1样式
array_push($conditionalStyles, $objConditional2);                                                   //在新的$conditionalStyles 后插入$objConditional2样式
array_push($conditionalStyles, $objConditional3);                                                   //在新的$conditionalStyles 后插入$objConditional3样式
$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('B2')-&gt;setConditionalStyles($conditionalStyles);           //把样式赋值给  B2

$objPHPExcel-&gt;getActiveSheet()-&gt;duplicateConditionalStyle(                                          //  复制 B2 的条件样式风格  至B3-B7
        $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('B2')-&gt;getConditionalStyles(),
        'B3:B7'
        );
</code></pre>

<h4>（15）循环数据，分页</h4>

<pre><code class="language-yaml">//循环输出 50 条数据
for ($i = 1; $i &lt;= 50; $i++) {
  $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A' . $i, &quot;FName $i&quot;);
  $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B' . $i, &quot;LName $i&quot;);
  $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C' . $i, &quot;PhoneNo $i&quot;);
  $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('D' . $i, &quot;FaxNo $i&quot;);
  $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('E' . $i, true);

  // 每 10 条数据 ， 分页一次（打印预览）
  if ($i % 10 == 0) {
    // 增加分页  函数 =》setBreak('A10',PHPExcel_Worksheet::BREAK_ROW)
    $objPHPExcel-&gt;getActiveSheet()-&gt;setBreak( 'A' . $i, PHPExcel_Worksheet::BREAK_ROW );
  }
}
</code></pre>

<h4>（16）填充</h4>

<pre><code class="language-yaml">//用数组填充表
//使用数组的内容从A2开始填充
$dataArray = array( array(&quot;2010&quot; ,    &quot;Q1&quot;,  &quot;United States&quot;,  790),
                   array(&quot;2010&quot; ,    &quot;Q2&quot;,  &quot;United States&quot;,  730),
                  );
$objPHPExcel-&gt;getActiveSheet()-&gt;fromArray($dataArray, NULL, 'A2');
</code></pre>

<h4>（17）自动筛选</h4>

<pre><code class="language-yaml">//设置自动筛选
$objPHPExcel-&gt;getActiveSheet()-&gt;setAutoFilter($objPHPExcel-&gt;getActiveSheet()-&gt;calculateWorksheetDimension());
 //$objPHPExcel-&gt;getActiveSheet()-&gt;calculateWorksheetDimension()     //得到A1行的所有内容
$autoFilter = $objPHPExcel-&gt;getActiveSheet()-&gt;getAutoFilter();    //获取自动筛选，用于增加删选条件
$autoFilter-&gt;getColumn('C')
    -&gt;setFilterType(PHPExcel_Worksheet_AutoFilter_Column::AUTOFILTER_FILTERTYPE_CUSTOMFILTER)
    -&gt;createRule()
    -&gt;setRule(
      PHPExcel_Worksheet_AutoFilter_Column_Rule::AUTOFILTER_COLUMN_RULE_EQUAL,
      'u*'          //u 开头，  * =&gt; 通配符
    )
    -&gt;setRuleType(PHPExcel_Worksheet_AutoFilter_Column_Rule::AUTOFILTER_RULETYPE_CUSTOMFILTER);
$autoFilter-&gt;getColumn('C')
    -&gt;createRule()
    -&gt;setRule(
      PHPExcel_Worksheet_AutoFilter_Column_Rule::AUTOFILTER_COLUMN_RULE_EQUAL,
      'japan'       // 为japan
    )
    -&gt;setRuleType(PHPExcel_Worksheet_AutoFilter_Column_Rule::AUTOFILTER_RULETYPE_CUSTOMFILTER);
$autoFilter-&gt;getColumn('E')
    -&gt;setFilterType(PHPExcel_Worksheet_AutoFilter_Column::AUTOFILTER_FILTERTYPE_FILTER)
    -&gt;createRule()
    -&gt;setRule(
      PHPExcel_Worksheet_AutoFilter_Column_Rule::AUTOFILTER_COLUMN_RULE_EQUAL,
      ''        //只显示是空白的
    );
</code></pre>

<h4>（18）单元格值范围设定 &amp;&amp; 下拉菜单</h4>

<pre><code class="language-yaml">//设置单元格值的范围
$objValidation = $objPHPExcel-&gt;getActiveSheet()-&gt;getCell('B3')-&gt;getDataValidation();
$objValidation-&gt;setType( PHPExcel_Cell_DataValidation::TYPE_WHOLE );      //whole类
$objValidation-&gt;setErrorStyle( PHPExcel_Cell_DataValidation::STYLE_STOP );    //错误级别
$objValidation-&gt;setAllowBlank(true);
$objValidation-&gt;setShowInputMessage(true);      //设置显示提示信息
$objValidation-&gt;setShowErrorMessage(true);      //设置显示错误信息
$objValidation-&gt;setErrorTitle('Input error');   //错误标题
$objValidation-&gt;setError('Only numbers between 10 and 20 are allowed!');
$objValidation-&gt;setPromptTitle('Allowed input');
$objValidation-&gt;setPrompt('Only numbers between 10 and 20 are allowed.');
$objValidation-&gt;setFormula1(10);      //设置最大值
$objValidation-&gt;setFormula2(20);      //设置最小值
//或者这样设置  $objValidation-&gt;setFormula2(1,5,6,7);  设置值是1，5，6，7中的一个数

$objValidation = $objPHPExcel-&gt;getActiveSheet()-&gt;getCell('B5')-&gt;getDataValidation();
$objValidation-&gt;setType( PHPExcel_Cell_DataValidation::TYPE_LIST );     //list类
$objValidation-&gt;setErrorStyle( PHPExcel_Cell_DataValidation::STYLE_INFORMATION );     
$objValidation-&gt;setAllowBlank(false);
$objValidation-&gt;setShowInputMessage(true);
$objValidation-&gt;setShowErrorMessage(true);
$objValidation-&gt;setShowDropDown(true);        //下拉菜单
$objValidation-&gt;setErrorTitle('Input error');
$objValidation-&gt;setError('Value is not in list.');
$objValidation-&gt;setPromptTitle('Pick from list');
$objValidation-&gt;setPrompt('Please pick a value from the drop-down list.');
$objValidation-&gt;setFormula1('&quot;Item A,Item B,Item C&quot;');  //下拉菜单内容为   Item A,Item B,Item C


$objValidation = $objPHPExcel-&gt;getActiveSheet()-&gt;getCell('B7')-&gt;getDataValidation();
$objValidation-&gt;setType( PHPExcel_Cell_DataValidation::TYPE_LIST );
$objValidation-&gt;setErrorStyle( PHPExcel_Cell_DataValidation::STYLE_INFORMATION );
$objValidation-&gt;setAllowBlank(false);
$objValidation-&gt;setShowInputMessage(true);
$objValidation-&gt;setShowErrorMessage(true);
$objValidation-&gt;setShowDropDown(true);
$objValidation-&gt;setErrorTitle('Input error');
$objValidation-&gt;setError('Value is not in list.');
$objValidation-&gt;setPromptTitle('Pick from list');
$objValidation-&gt;setPrompt('Please pick a value from the drop-down list.');
$objValidation-&gt;setFormula1('$D$2:$D$6'); //下拉菜单内容为 D2  - D6 
</code></pre>

<h4>（19）自动转换</h4>

<pre><code class="language-yaml">$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle( 'B5')-&gt;getAlignment()-&gt;setShrinkToFit(true); //自动转换显示字体大小,使内容能够显示 字体大小变小
$objPHPExcel-&gt;getActiveSheet()-&gt;getCell(B14)-&gt;getValue();           //获得值，有可能得到的是公式
$objPHPExcel-&gt;getActiveSheet()-&gt;getCell(B14)-&gt;getCalculatedValue();//获得算出的值
</code></pre>

<h4>（20）导入 &amp;&amp; 读取</h4>

<pre><code class="language-yaml">//导入，读取
//通过PHPExcel_IOFactory::load方法来载入一个文件，load会自动判断文件的后缀名来导入相应的处理类，读取格式保含xlsx/xls/xlsm/ods/slk/csv/xml/gnumeric
require_once '../Classes/PHPExcel/IOFactory.php';
$objPHPExcel = PHPExcel_IOFactory::load(
//把载入的文件默认表（一般都是第一个）通过toArray方法来返回一个多维数组
$dataArray = $objPHPExcel-&gt;getActiveSheet()-&gt;toArray();
//读完直接写到一个xlsx文件里
$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007'); //$objPHPExcel是上文中读的资源
$objWriter-&gt;save(str_replace('.php', '.xlsx', __FILE__));


//读取xml文件
$objReader = PHPExcel_IOFactory:: createReader('Excel2003XML' );
$objPHPExcel = $objReader-&gt;load( &quot;Excel2003XMLTest.xml&quot; );

//读取ods文件
$objReader = PHPExcel_IOFactory:: createReader('OOCalc' );
$objPHPExcel = $objReader-&gt;load(&quot;OOCalcTest.ods&quot; );

//读取numeric文件
$objReader = PHPExcel_IOFactory:: createReader('Gnumeric' );
$objPHPExcel = $objReader-&gt;load( &quot;GnumericTest.gnumeric&quot; );

//读取slk文件
$objPHPExcel = PHPExcel_IOFactory:: load(&quot;SylkTest.slk&quot; );

//循环遍历数据
$objReader = PHPExcel_IOFactory::createReader('Excel2007' ); //创建一个2007的读取对象
$objPHPExcel = $objReader-&gt;load (&quot;05featuredemo.xlsx&quot; );             //读取一个xlsx文件
foreach ($objPHPExcel-&gt;getWorksheetIterator() as $worksheet) {     //遍历工作表
       echo 'Worksheet - ' , $worksheet-&gt;getTitle() , PHP_EOL;
       foreach ($worksheet-&gt;getRowIterator() as $row) {       //遍历行
             echo '    Row number - ' , $row-&gt;getRowIndex() , PHP_EOL;
            $cellIterator = $row-&gt;getCellIterator();   //得到所有列
            $cellIterator-&gt;setIterateOnlyExistingCells( false); // Loop all cells, even if it is not set
             foreach ($cellIterator as $cell) {  //遍历列
                   if (!is_null($cell)) {  //如果列不给空就得到它的坐标和计算的值
                         echo '        Cell - ' , $cell-&gt;getCoordinate() , ' - ' , $cell-&gt;getCalculatedValue() , PHP_EOL;
                  }
            }
      }
}
//数组插入的表中
$data = array( array('title'      =&gt; 'Excel for dummies',
                     'price'      =&gt; 17.99,
                     'quantity'   =&gt; 2
                     ),
              array('title'       =&gt; 'PHP for dummies',
                     'price'      =&gt; 15.99,
                     'quantity'  =&gt; 1
                     ),
              array('title'      =&gt; 'Inside OOP',
                     'price'      =&gt; 12.95,
                     'quantity'  =&gt; 1
                     )
             );
$baseRow = 5;      //指定插入到第5行后
foreach($data as $r =&gt; $dataRow) {
      $row = $baseRow + $r;    //$row是循环操作行的行号
      //在操作行的号前加一空行，这空行的行号就变成了当前的行号
      $objPHPExcel-&gt;getActiveSheet()-&gt;insertNewRowBefore($row,1);   
       //对应的列都附上数据和编号
      $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue( 'A'.$row, $r+1);     
      $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue( 'B'.$row, $dataRow['title']);
      $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue( 'C'.$row, $dataRow['price']);
      $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue( 'D'.$row, $dataRow['quantity']);
      $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue( 'E'.$row, '=C'.$row.'*D' .$row);
}
//最后删去第4行，这是示例需要，在此处为大家提供删除实例
$objPHPExcel-&gt;getActiveSheet()-&gt;removeRow($baseRow-1,1);     
</code></pre>

<h4>（21）处理中文输出问题</h4>

<pre><code class="language-yaml">//处理中文输出问题
//需要将字符串转化为UTF-8编码，才能正常输出，否则中文字符将输出为空白，如下处理：
$str  = iconv('gb2312', 'utf-8', $str);
//或者写一个函数专门处理中文字符串：
function convertUTF8($str)
{
   if(empty($str)) return '';
   return  iconv('gb2312', 'utf-8', $str);
}
</code></pre>

<h4>（22）数据库输出数据处理</h4>

<pre><code class="language-yaml">//从数据库输出数据处理方式
//从数据库读取数据如：
$db = new Mysql($dbconfig);
$sql = &quot;SELECT * FROM  表名&quot;;
$row = $db-&gt;GetAll($sql);  // $row 为二维数组
$count = count($row);
for ($i = 2; $i &lt;= $count+1; $i++) {
 $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A' . $i, convertUTF8($row[$i-2][1]));
 $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B' . $i, convertUTF8($row[$i-2][2]));
 $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C' . $i, convertUTF8($row[$i-2][3]));
 $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('D' . $i, convertUTF8($row[$i-2][4]));
 $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('E' . $i, convertUTF8(date(&quot;Y-m-d&quot;, $row[$i-2][5])));
 $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('F' . $i, convertUTF8($row[$i-2][6]));
 $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('G' . $i, convertUTF8($row[$i-2][7]));
 $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('H' . $i, convertUTF8($row[$i-2][8]));
}
</code></pre>

<h4>（23）数据库输出数据处理</h4>

<p>//转CSV文件
看官方样例  <code>16csv.php</code>
//转HTML文件
看官方样例  <code>17html.php</code>
//命名区域
看官方样例  <code>19namedrange.php</code></p>

<h4>（24）循环输出</h4>

<pre><code class="language-yaml">// 循环输出
28iterator.php
$objReader = PHPExcel_IOFactory::createReader('Excel2007');
$objPHPExcel = $objReader-&gt;load(&quot;05featuredemo.xlsx&quot;);

echo date('H:i:s') , &quot; Iterate worksheets&quot; , EOL;
foreach ($objPHPExcel-&gt;getWorksheetIterator() as $worksheet) {
  echo 'Worksheet - ' , $worksheet-&gt;getTitle() , EOL;

  foreach ($worksheet-&gt;getRowIterator() as $row) {
    echo '    Row number - ' , $row-&gt;getRowIndex() , EOL;

    $cellIterator = $row-&gt;getCellIterator();
    $cellIterator-&gt;setIterateOnlyExistingCells(false); // Loop all cells, even if it is not set
    foreach ($cellIterator as $cell) {
      if (!is_null($cell)) {
        echo '        Cell - ' , $cell-&gt;getCoordinate() , ' - ' , $cell-&gt;getCalculatedValue() , EOL;
      }
    }
  }
}
</code></pre>

<h4>（25）保存</h4>

<pre><code class="language-yaml">//保存
$objWriter = new PHPExcel_Writer_Excel2007($objPHPExcel);
$objWriter-&gt;save(str_replace('.php', '.xlsx', __FILE__));
//保存
require_once('Classes/PHPExcel/Writer/Excel5.php');
$objWriter = new PHPExcel_Writer_Excel5($objPHPExcel);
$objWriter-&gt;save(str_replace('.php', '.xls', __FILE__));

//1.6.2新版保存
require_once('Classes/PHPExcel/IOFactory.php');
$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
$objWriter-&gt;save(str_replace('.php', '.xls', __FILE__));
$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');
$objWriter-&gt;save(str_replace('.php', '.xls', __FILE__));

// 从浏览器直接输出$filename
header(&quot;Pragma: public&quot;);
header(&quot;Expires: 0&quot;);
header(&quot;Cache-Control:must-revalidate, post-check=0, pre-check=0&quot;);
header(&quot;Content-Type:application/force-download&quot;);
header(&quot;Content-Type: application/vnd.ms-excel;&quot;);
header(&quot;Content-Type:application/octet-stream&quot;);
header(&quot;Content-Type:application/download&quot;);
header(&quot;Content-Disposition:attachment;filename=&quot;.$filename);
header(&quot;Content-Transfer-Encoding:binary&quot;);
$objWriter-&gt;save(&quot;php://output&quot;); 

// 输出文档到页面  
header('Content-Type: application/vnd.ms-excel');  
header('Content-Disposition: attachment;filename=&quot;test.xls&quot;');  
header('Cache-Control: max-age=0');  
PHPExcel_IOFactory::createWriter($phpexcel, 'Excel5')-&gt;save('php://output'); 
</code></pre>
</article>
                <section class="author">
                    <div class="avatar" style="background-image: url(/images/avatar.jpg);"></div>
                    <a class="name" href="/about.me.html">言唸</a>
                    <div class="intro">____phper</div>
                </section>
                <section class="recommend">
                    
                    
                    <section class="nav next">
                        <div class="head">下篇文章</div>
                        <a class="link" href="/ink-blog-phpweb.html">PHP Web 开发基础</a>
                    </section>
                    
                </section>
                
    <section id="disqus_thread"></section>
    <script type="text/javascript">
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//PHPer.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>


            </article>
        </article>
        <footer class="footer">
    <span class="copyright">
        PHP ©
        <script type="text/javascript">
            document.write(new Date().getFullYear());
        </script>
    </span>
    <span class="publish">Powered by <a href="http://www.inkpaper.io/" target="_blank">Ink</a></span>
</footer>

        <script src="/bundle/index.js"></script>
    </body>
</html>
